<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:security="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/security 
					http://www.springframework.org/schema/security/spring-security.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
			
	<!-- 접근설정 -->
	<!-- Error페이지 지정 -->
	<bean id="customAccessDenied" class="com.greencar.security.CustomAccessDeniedHandler"></bean>
	<!-- 패스워드 암호화 -->
	<!-- <bean id="bcryptPasswordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"></bean> -->
	
	<!-- <bean id="customUserDetailService" class="com.greencar.security.CustomUserDetailService"></bean> -->
	<!-- css,js,image 파일에 대해서는 시큐리티적용 해제 -->
	<security:http pattern="/**/*.js" security="none" />
	<security:http pattern="/**/*.css" security="none" />
	<security:http pattern="/image/*" security="none" />
	
             
	<security:http auto-config="true" use-expressions="true">
			
		<!-- 전체사용자 접근설정 -->
		<security:intercept-url pattern="/logon/all" access="permitAll" />
		<!-- 로그인유저 접근경로설정 -->
		<security:intercept-url pattern="/login/member" access="hasRole('ROLE_MEMBER',ROLE_ADMIN)" />
		<!-- /admin/** 경로의 접근에 대해 ROLE_ADMIN이라는 권한을 가진 ID만을 접근허용 -->
		<security:intercept-url pattern="/admin/**" access="hasRole('ROLE_ADMIN')"/>
		
		<!-- 로그인페이지 경로설정 => 반드시 GET방식으로 접근하는 URI 지정-->
		<security:form-login login-page="/login/customLogin"/>
		
		<!-- 로그아웃처리 경로지정-->
		<security:logout logout-url="/login/logout" invalidate-session="true"/>
		<!-- 접근제한 에러시 이동할 경로지정 -->
		<!-- <security:access-denied-handler error-page="/accessError"/> -->
		
		<!-- Error페이지 지정대신 customAccessDeniedHandler 빈으로 등록하여 사용 -->
		<security:access-denied-handler ref="customAccessDenied"/>
		
	</security:http>
	
	<!-- 로그인 -->
	
	<!-- 인증을 담당하는 객체로  AuthenticationProvider 를 통해 인증하도록 한다.-->
	<security:authentication-manager>
	
		<!-- customUserDetailService를 통해  DB데이터 호출 하여 비교작업. UserDetailsService => 인증권한에 대한 실제처리 -->
		<!-- <security:authentication-provider user-service-ref="customUserDetailService">  -->
			<!-- JDBC 기본쿼리로 인증(username) -->
			<!-- <security:jdbc-user-service data-source-ref="dataSource" /> -->
		
		<security:authentication-provider>
		<!-- 기존테이블에서 쿼리로 호출 -->
			<security:jdbc-user-service data-source-ref="dataSource"
				users-by-username-query="SELECT user_email, user_pw, enable FROM user_info WHERE user_email = ?"
										
				authorities-by-username-query="SELECT user_email, authority FROM auth WHERE user_email = ?"/>
		
			<!-- <security:password-encoder ref="bcryptPasswordEncoder" /> -->
			
			<!-- 수동로그인 -->
			<!-- <security:user-service>
				 
				member = ROLE_MEMBER 권한만을 부여
				<security:user name="member"  password="member" authorities="ROLE_MEMBER"/>
				admin =  ROLE_MEMBER, ROLE_ADMIN 의 권한부여(member와 admin 모두 접근가능)
				<security:user name="admin"  password="admin" authorities="ROLE_MEMBER, ROLE_ADMIN"/>-->
					
		</security:authentication-provider>
		
	</security:authentication-manager>

</beans>

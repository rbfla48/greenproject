<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:security="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/security 
					http://www.springframework.org/schema/security/spring-security.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
	<!-- Error페이지 지정 -->
	<bean id="customAccessDenied" class="com.greencar.security.CustomAccessDeniedHandler"></bean>
	<!-- 패스워드 암호화 -->
	<!-- <bean id="bcryptPasswordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"></bean> -->
	
	<bean id="customUserDetailService" class="com.greencar.security.CustomUserDetailService"></bean>
	
	<security:http auto-config="true" use-expressions="true">
		
		<security:intercept-url pattern="/login/all" access="permitAll" />
		
		<security:intercept-url pattern="/login/member" access="hasRole('ROLE_MEMBER')" />
		<!-- /greencar/admin 경로의 접근에 대해 ROLE_ADMIN이라는 권한을 가진 ID만을 접근허용 -->
		<security:intercept-url pattern="/login/admin" access="hasRole('ROLE_ADMIN')"/>
		
		<!-- 로그인페이지 경로설정 => 반드시 GET방식으로 접근하는 URI 지정-->
		<security:form-login login-page="/login/customLogin"/>
		
		<!-- 로그아웃처리 경로지정-->
		<security:logout logout-url="/login/logout" invalidate-session="true"/>
		<!-- 접근제한 에러시 이동할 경로지정 -->
		<!-- <security:access-denied-handler error-page="/accessError"/> -->
		
		<!-- Error페이지 지정대신 customAccessDeniedHandler 빈으로 등록하여 사용 -->
		<security:access-denied-handler ref="customAccessDenied"/>
		
	</security:http>
	
	<security:authentication-manager>
	
		<!-- 기존의테이블에서  customUserDetailService를 통해 VO데이터 호출 -->
		<security:authentication-provider user-service-ref="customUserDetailService"> 
			<!-- JDBC 기본쿼리로 인증(username) -->
			<!-- <security:jdbc-user-service data-source-ref="dataSource" /> -->
			<!-- 기존테이블에서 쿼리로 호출 -->
			<!-- <security:jdbc-user-service data-source-ref="dataSource" 
				users-by-username-query="SELECT user_email, user_pw, enable FROM user_info WHERE user_email = ? "
				authorities-by-username-query="SELECT user_email, authority FROM auth WHERE user_email = ?"/> -->
			
			
						
			<!-- <security:password-encoder ref="bcryptPasswordEncoder" /> -->
			
			<!-- 수동로그인 -->
			<!-- <security:user-service>
				UserDetailsService => 인증권한에 대한 실제처리 
				member = ROLE_MEMBER 권한만을 부여
				<security:user name="member"  password="member" authorities="ROLE_MEMBER"/>
				admin =  ROLE_MEMBER, ROLE_ADMIN 의 권한부여(member와 admin 모두 접근가능)
				<security:user name="admin"  password="admin" authorities="ROLE_MEMBER, ROLE_ADMIN"/>
				
			</security:user-service> -->
			
		</security:authentication-provider>
		
	</security:authentication-manager>

</beans>
